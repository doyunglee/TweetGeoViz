<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>Predictionary</title>

	<!-- The noUiSlider stylesheet
	<link href="static/jquery.nouislider.min.css" rel="stylesheet"> -->
	<!-- Latest compiled and minified bootstrap CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
	<!-- Latest compiled and minified bootstrap material CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.2.2/css/material-wfont.css">
	<!--Main style sheet -->
	<link rel=stylesheet type=text/css href="/static/style.css">

	<!-- Jquery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.2.2/js/material.min.js"></script>

	<!-- Latest compiled and minified d3 -->
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<!-- Latest compiled and minified d3 queue-->
	<script src="http://d3js.org/queue.v1.min.js"></script>
	<!-- Latest compiled and minified d3 topojson -->
	<script src="http://d3js.org/topojson.v1.min.js"></script>
	<!-- The noUiSlider script-->
	<link href="static/jquery.nouislider.min.css" rel="stylesheet">
	<!-- Use the 'all' version to get all documented features. -->
	<script src="static/jquery.nouislider.all.min.js"></script>
    <!-- Roboto font -->
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <!-- word-cloud js -->
    <script src="static/d3.layout.cloud.js"></script>
</head>

<body>
	<header class="navbar navbar-fixed-top">
		<a class="navbar-brand" href="#">Predictionary</a>
	</header>

	<div class="container-fluid">
		<div class ="row">
			<!--Left, tall box-->
			<div class="col-md-3">
				<!--This is where the word cloud will be-->
				<div class="well sidebar" >
					<div id="wordcloudcontainer" class="well">
						<script type="text/javascript">
							var divwidth = wordcloudcontainer.offsetWidth;
							d3.json("static/wordcloud.json", function(data) {
								makeCloud(data)
							});

							function makeCloud(data) {
								var fill = d3.scale.category20();
							    //get words
							    wordarray = Object.keys(data)
							    //get weights of words
							    weightarray = [];
							    for(var key in data) {
								weightarray.push(data[key]);
							    }
							    //make cloud
							    d3.layout.cloud().size([divwidth-70, divwidth-70])
								.words(d3.zip(wordarray, weightarray).map(function(d) {
								    return {text: d[0], size: d[1]};
								}))
								.padding(5)
								.rotate(function() { return 0; })
								.font("Roboto")
								.fontSize(function(d) { return d.size; })
								.on("end", draw)
								.start();
							    function draw(words) {
								d3.select("#wordcloudcontainer").append("svg")
								    .attr("width", divwidth)
								    .attr("height", divwidth)
								    .append("g")
								    .attr('transform',"translate("+$('#wordcloudcontainer').width()/2+ ","+$('#wordcloudcontainer').height()/2+")")
								    .selectAll("text")
								    .data(words)
								    .enter().append("text")
								    .style("font-size", function(d) { return d.size + "px"; })
								    .style("font-family", "Roboto")
								    .style("fill", "black")
								    .style("font-weight", "700")
								    .attr("text-anchor", "middle")
								    .attr("transform", function(d) {
								      return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
								    })
								    .text(function(d) { return d.text; });
							    }	
							}
						    
						
						</script>
					</div>
					<div class="well controlls-well">
						<h3> Location: </h3>
						<form class="form-inline">
						  <div class="form-group">
						    <label for="lat">Lat</label>
						    <input type="text" class="form-control" id="lat" placeholder="32.7">
						  </div>
						  <div class="form-group">
						    <label for="long">Long</label>
						    <input type="text" class="form-control" id="long" placeholder="-117">
						  </div>
						</form>
						<script >
						$( "#lat" ).change(function() {
  							latitude_point = document.getElementById('lat').value
						});
						$( "#long" ).change(function() {
  							longitude_point = document.getElementById('long').value
						});
						</script>	
						<h3> Time: </h3>
						<form class="form-inline">
						  <div class="form-group">
						    <label for="start">Start</label>
						    <input type="date" class="form-control" id="start">
						  </div>
						  <div class="form-group">
						    <label for="end">End</label>
						    <input type="date" class="form-control" id="end">
						  </div>
						</form>
						<button class="btn btn-fab btn-raised btn-sm btn-success btn-done"><i class="mdi-navigation-check"></i></button>
					</div>
				</div>
			</div>

			<!--Top right, large box-->
			<div class="col-md-9 map-box">
				<div class="well map-well" id="map-station">
					<!--This is where the map is going to live-->
					<div id="map-container" style="text-align:center">
						<script type="text/javascript">
							//initialization of the map
					var scale = .8
			                var width = 960*scale,
			                    height = 500*scale;
			                var projection = d3.geo.albersUsa()
			                    .scale(1000*scale)
			                    .translate([width / 2, height / 2]);
			                var path = d3.geo.path()
			                    .projection(projection);
			                var svg = d3.select("#map-container").append("svg")
			                    .attr("width", width)
			                    .attr("height", height);

			                //This is where we draw the map of the US
			                d3.json("/static/states.json", function(error, us) {
			                    svg.insert("path", ".graticule")
			                        .datum(topojson.feature(us, us.objects.land))
			                        .attr("class", "land")
			                        .attr("d", path);

			                    svg.insert("path", ".graticule")
			                        .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
			                        .attr("class", "state-boundary")
			                        .attr("d", path);

			                    //This is where we're going to draw the circles on the map:
		                        coordinates = [-117, 32.7];
		                        // add circles to svg
							    svg.selectAll("circle")
									.data([coordinates]).enter()
									.append("circle")
									.attr("cx", function (d) { return projection(d)[0]; })
									.attr("cy", function (d) { return projection(d)[1]; })
									.attr("r", "8px")
									.attr("fill", "red")

			                    $( "#long" ).change(function() {
			                    	//This is where we're going to draw the circles on the map:
			                        coordinates = [longitude_point, latitude_point];
			                        console.log(coordinates)
			                        // add circles to svg
								    d3.select("circle")
								    	.transition()
								    	.duration(100)
								    	.attr("transform", function(d) {return "translate(" + projection(coordinates) + ")";})
										// .attr("cx", projection(longitude_point))
										// .attr("cy", projection(latitude_point))
										.attr("r", "8px")
										.attr("fill", "red")
		                    	});
			                    
							});
	                		d3.select(self.frameElement).style("height", height + "px");

						</script>
					</div>
				</div>

				<div class="well bottombar">
					<h3>TIMELINE</h3>
					<h5>outer area:</h5>
  					<div id="slider-area" class="slider"></div>
  					<h5>Uniqueness:</h5>
					<div id="slider-uniqueness" class="slider"></div>
					<script type="text/javascript">
						console.log("slider-script");
  						$('#slider-area').noUiSlider({
							start: [ .1, 3 ],
							range: {
								'min': [  .01 ],
								'max': [ 10 ]
							}
						});
						$('#slider-uniqueness').noUiSlider({
							start: [ 50 ],
							range: {
								'min': [  0 ],
								'max': [ 100 ]
							}
						});
						$('.btn-done').click(function (){
							console.log("btn-clicked!")
							var data = {
								start: $('#start').val(),
								end: $('#end').val(),
								epiLt: $('#lat').val(),
								epiLn: $('#long').val(),
								r1: $('#slider-area').val()[0],
								r2: $('#slider-area').val()[0],
								u: $('#slider-uniqueness').val(),
							};
							console.log(data);

							$.get('/query', data, function (words){
								console.log(words);
								makeCloud(words)
							});
						});
  					</script>
				</div>
			</div>
		</div>
	</div>

</body>

</html>
